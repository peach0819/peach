<!DOCTYPE html>
<html>
    <head>
        <title>产品组 : 3. hi卡分摊收款手续费</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">产品组</a></span>
                            </li>
                                                    <li>
                                <span><a href="70335729.html">01_数据逻辑及模型设计思路</a></span>
                            </li>
                                                    <li>
                                <span><a href="59212882.html">二、履约成本</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            产品组 : 3. hi卡分摊收款手续费
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> 未知用户 (lei.xue)</span>, last modified by <span class='editor'> 杨佳丽</span> on 2022-12-08
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 class="auto-cursor-target" id="id-3.hi卡分摊收款手续费-修订记录"><strong>修订记录</strong></h1><div class="table-wrap"><table class="relative-table confluenceTable" style="width: 27.8763%;"><colgroup><col style="width: 15.9846%;"/><col style="width: 24.5167%;"/><col style="width: 11.6486%;"/><col style="width: 14.0899%;"/><col style="width: 33.7376%;"/></colgroup><thead><tr><th style="text-align: left;" class="confluenceTh"><p>版本号</p></th><th style="text-align: left;" class="confluenceTh"><p>内容</p></th><th style="text-align: left;" class="confluenceTh"><p>作者</p></th><th style="text-align: left;" class="confluenceTh"><p>时间</p></th><th colspan="1" style="text-align: left;" class="confluenceTh"><p>备注</p></th></tr></thead><tbody><tr><td colspan="1" class="confluenceTd">V1</td><td colspan="1" class="confluenceTd">新增渠道营销费用</td><td colspan="1" class="confluenceTd">阿雷</td><td colspan="1" class="confluenceTd">2022.06.22</td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1702954311816 {padding: 0px;}
div.rbtoc1702954311816 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1702954311816 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1702954311816'>
<ul class='toc-indentation'>
<li><a href='#id-3.hi卡分摊收款手续费-修订记录'>修订记录</a>
<ul class='toc-indentation'>
<li><a href='#id-3.hi卡分摊收款手续费-引用'>引用</a></li>
</ul>
</li>
<li><a href='#id-3.hi卡分摊收款手续费-业务背景'>业务背景</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-V1版本--最新版–22年7月至今'>V1版本 --最新版–22年7月至今</a>
<ul class='toc-indentation'>
<li><a href='#id-3.hi卡分摊收款手续费-名词字段'>名词字段</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-计算步骤'>计算步骤</a>
<ul class='toc-indentation'>
<li><a href='#id-3.hi卡分摊收款手续费-步骤一、判断订单是否为&quot;hi卡充值订单&quot;'>步骤一、判断 订单是否为 &quot;hi卡充值订单&quot; </a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤二、当订单是&quot;hi卡充值订单&quot;时'>步骤二、当 订单 是  &quot;hi卡充值订单&quot; 时</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤三、当订单是&quot;hi卡充值订单&quot;时的首次分摊'>步骤三、当 订单 是 &quot;hi卡充值订单&quot; 时的首次分摊</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤四、当订单是&quot;hi卡充值订单&quot;时的二次分摊'>步骤四、当 订单 是 &quot;hi卡充值订单&quot; 时的二次分摊</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤五、当订单是&quot;hi卡充值订单&quot;时的兜底分摊'>步骤五、当 订单 是 &quot;hi卡充值订单&quot; 时的兜底分摊</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤五、基于每一条手续费流水订单明细对应的被匹配的订单流水池的明细,分别计算其占比,分摊'>步骤五、基于每一条 手续费流水订单明细 对应的 被匹配的 订单流水池 的明细,分别计算其占比,分摊</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤六、产出每一条费用对应的订单流水明细表'>步骤六、产出每一条费用对应的订单流水明细表</a></li>
<li><a href='#id-3.hi卡分摊收款手续费-步骤七、聚合汇总,并合并回主表'>步骤七、聚合汇总,并合并回主表</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#id-3.hi卡分摊收款手续费-监控预警'>监控预警</a></li>
</ul>
</div></p><h2 id="id-3.hi卡分摊收款手续费-引用"><strong>引用</strong></h2><p><a class="external-link" href="http://demo.yangtuojia.com/%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1/%E8%B4%A2%E5%8A%A1%E4%B8%AD%E5%BF%83/02_%E9%A1%B9%E7%9B%AE/201905_01_%E6%AF%9B%E5%88%A9%E6%8A%A5%E8%A1%A8/201905_%E9%A1%B9%E7%9B%AE_01%20%E6%AF%9B%E5%88%A9%E6%8A%A5%E8%A1%A8%E4%BA%A7%E5%93%81%E5%8C%96/#g=1&amp;p=%E4%B8%9A%E5%8A%A1%E6%AF%9B%E6%94%B6%E5%85%A5" rel="nofollow" style="text-decoration: none;">采购毛利报表一期</a></p><h1 id="id-3.hi卡分摊收款手续费-业务背景">业务背景</h1><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/98208314/98208498.png" data-image-src="attachments/98208314/98208498.png" data-unresolved-comment-count="0" data-linked-resource-id="98208498" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2022-6-22_10-38-38.png" data-base-url="http://k.yangtuojia.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="98208314" data-linked-resource-container-version="16"></span></p><p>见上图, 以现有的逻辑为例,  因为 hi卡充值 都归属在 卡券票 下面.  如果用hi卡购买实货,则 只有平台才会承担起 收款手续费, 对应的渠道和采购 都不会承担. 理论误差是 hi卡充值金额 * 0.3%</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="150" src="attachments/98208314/98208494.png" data-image-src="attachments/98208314/98208494.png" data-unresolved-comment-count="0" data-linked-resource-id="98208494" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2022-6-22_10-35-18.png" data-base-url="http://k.yangtuojia.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="98208314" data-linked-resource-container-version="16"></span></p><p><br/></p><h1 id="id-3.hi卡分摊收款手续费-V1版本--最新版–22年7月至今">V1版本 --最新版–22年7月至今</h1><h2 id="id-3.hi卡分摊收款手续费-名词字段"><strong>名词字段</strong></h2><div class="table-wrap"><table class="relative-table confluenceTable" style="width: 24.6956%;"><thead><tr><th style="text-align: left;" class="confluenceTh"><p>名词</p></th><th style="text-align: left;" class="confluenceTh"><p>备注</p></th></tr><tr><td colspan="1" class="confluenceTd"><span style="color: rgb(255,0,0);">【收款手续费】</span></td><td colspan="1" class="confluenceTd"><p>即 <span>order_rate_fee. 包含正逆向</span></p><p><span>是 该订单客观产生的 付给第三方支付渠道 的费用.</span></p></td></tr><tr><td colspan="1" class="confluenceTd"><span style="color: rgb(51,102,255);">【hi卡分摊收款手续费】</span></td><td colspan="1" class="confluenceTd">是 基于海拍客对考核对象的承担要求,基于公平性出发进行相关的处理逻辑</td></tr><tr><td colspan="1" class="confluenceTd"><strong><span style="color: rgb(204,153,255);">手续费流水订单明细</span></strong></td><td colspan="1" class="confluenceTd">指 准备拿来计算的 这笔订单.</td></tr><tr><td colspan="1" class="confluenceTd"><strong><span style="color: rgb(51,153,102);">被匹配的 订单流水池</span></strong></td><td colspan="1" class="confluenceTd">指发生在当月的 订单流水. 是分摊过程中,被匹配的对象. 跟 这笔手续费没有半毛钱关系</td></tr><tr><td colspan="1" class="confluenceTd"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);"><strong><span style="color: rgb(255,102,0);">hi卡支付金额-退款</span></strong></span></span></span></td><td colspan="1" class="confluenceTd"><p>指 订单上的 hi卡支付金额 - hi卡支付退款金额.</p><p>逻辑类似可参见 <a href="54522053.html">99. 计算分摊占比的指标</a> </p></td></tr></thead></table></div><p><br/></p><h2 id="id-3.hi卡分摊收款手续费-计算步骤"><strong>计算步骤</strong></h2><h3 id="id-3.hi卡分摊收款手续费-步骤一、判断订单是否为&quot;hi卡充值订单&quot;"><strong>步骤一、判断 订单是否为 &quot;hi卡充值订单&quot; </strong></h3><p>取出 发生在 当月的 正逆向 订单数据, 并判断其 是否为 hi卡充值订单,且其 <strong><span style="color: rgb(51,102,255);"><span style="color: rgb(255,0,0);">【收款手续费】 不等于0 . </span></span></strong></p><p><strong><span style="color: rgb(51,102,255);"><span style="color: rgb(255,0,0);">注意! 这里 不等于0 ,包括 &gt;0 和 &lt;0 两种情况. </span></span></strong></p><p>注意! 不能用 是否类目为 卡券票, 或者 是否为 虚拟产品 的逻辑来判断.</p><p>逻辑上,可以通过判断该订单背后的商品是否有通过hi卡绑定礼包套餐,或者有其他的业务逻辑</p><p><br/></p><h3 id="id-3.hi卡分摊收款手续费-步骤二、当订单是&quot;hi卡充值订单&quot;时"><strong>步骤二、当 订单 <span style="color: rgb(255,0,0);">是</span>  &quot;hi卡充值订单&quot; 时</strong></h3><p><strong>则  <span style="color: rgb(51,102,255);">【hi卡分摊收款手续费】  =   <span style="color: rgb(255,0,0);">【收款手续费】 * -1 </span></span></strong></p><p><strong><span style="color: rgb(51,102,255);"><span style="color: rgb(255,0,0);">注意! 这里就是负数. 倒一下.</span></span></strong></p><p>注意! 这里的意思是,  本身这个 hi卡充值的订单, 要先给他一个 负数的 分摊后手续费. 同时,这个hi卡充值的订单, 要分摊到 其他的实货订单上面! </p><p>所以下面的分摊,还是基于 这里的 同一批订单的 <strong><span style="color: rgb(51,102,255);"><span style="color: rgb(255,0,0);">【收款手续费】 </span></span></strong><span style="color: rgb(0,51,102);">进行分摊</span></p><h3 id="id-3.hi卡分摊收款手续费-步骤三、当订单是&quot;hi卡充值订单&quot;时的首次分摊"><strong>步骤三、当 订单 <span style="color: rgb(255,0,0);">是</span> &quot;hi卡充值订单&quot; 时的首次分摊</strong></h3><p>则此时直接进入 分摊. 针对发生在当月 并且 是 <strong>&quot;hi卡充值订单&quot; 时,(如果不是hi卡充值订单,不需要分摊! )</strong></p><p><strong>基于以下逻辑去匹配 订单流水,用以分摊.  每条 <span style="color: rgb(204,153,255);">手续费流水订单明细 <span style="color: rgb(0,0,0);">去 笛卡尔积匹配 <span style="color: rgb(51,153,102);">被匹配的 订单流水池 , <span style="color: rgb(0,0,0);">并基于下面的匹配条件进行过滤出实际上匹配的到的</span></span></span></span></strong></p><p><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(0) </span></span></span></span><span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池</strong> </span><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">的 <strong><span style="color: rgb(255,102,0);">hi卡支付金额-退款</span></strong> 必须&gt;0 </span></span></span></span></p><p>(1) <span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池</strong> <span style="color: rgb(0,0,0);">的 业务时间 必须在 当月</span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(2) <span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池 </strong></span>必须是 海拍客自营订单(sale-dc_id = 0 或者 -1 ) </span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(3) <span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池 </strong></span>必须是 实货订单 (即 业务组 不等于 卡券票,其他)</span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(4) <strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">的 商品品牌 等于 <strong><span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong>的 商品品牌</span></span></span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">(5)<strong> <span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong>的门店id<strong> = <span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong>的门店id</span></span></span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">(6) <span style="color: rgb(204,153,255);"><strong>手续费流水订单明细 </strong></span>的AB类型<strong> = <span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong>的AB类型</span></span></span></span></p><p><br/></p><h3 id="id-3.hi卡分摊收款手续费-步骤四、当订单是&quot;hi卡充值订单&quot;时的二次分摊"><strong>步骤四、当 订单 <span style="color: rgb(255,0,0);">是</span> &quot;hi卡充值订单&quot; 时的二次分摊</strong></h3><p>如果 步骤三 分摊不到,则进入 第二次分摊</p><p><strong>基于以下逻辑去匹配 订单流水,用以分摊.  每条 <span style="color: rgb(204,153,255);">手续费流水订单明细 <span style="color: rgb(0,0,0);">去 笛卡尔积匹配 <span style="color: rgb(51,153,102);">被匹配的 订单流水池 , <span style="color: rgb(0,0,0);">并基于下面的匹配条件进行过滤出实际上匹配的到的</span></span></span></span></strong></p><p><strong><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(0) </span></span></span></span><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);">被匹配的 订单流水池 </span></span></span></span></span></strong><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">的 <span style="color: rgb(255,102,0);">hi卡支付金额-退款</span> 必须&gt;0 </span></span></span></span></p><p>(1) <span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池</strong> <span style="color: rgb(0,0,0);">的 业务时间 必须在 当月</span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(2) <strong>被匹配的 订单流水池 </strong>必须是 海拍客自营订单(sale-dc_id = 0 或者 -1 ) </span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(3) <strong>被匹配的 订单流水池 </strong>必须是 实货订单 (即 业务组 不等于 卡券票,其他)</span></span></p><p><s><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(4) <strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong><span style="color: rgb(204,153,255);">的 商品品牌 等于 <strong>被匹配的 订单流水池 </strong>的 商品品牌  </span></span></span></s><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);">  <span style="color: rgb(0,0,0);">步骤三 和 步骤四的主要区别就是少了 4 这一条</span></span></span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);">(5)<strong> 手续费流水订单明细 </strong><span style="color: rgb(0,0,0);">的门店id</span><strong> = <span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong><span style="color: rgb(0,0,0);">的门店id</span></span></span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">(6) <span style="color: rgb(204,153,255);"><strong>手续费流水订单明细 </strong></span>的AB类型<strong> = <span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong>的AB类型</span></span></span></span></p><p><br/></p><h3 id="id-3.hi卡分摊收款手续费-步骤五、当订单是&quot;hi卡充值订单&quot;时的兜底分摊"><strong>步骤五、当 订单 <span style="color: rgb(255,0,0);">是</span> &quot;hi卡充值订单&quot; 时的兜底分摊</strong></h3><p>如果 步骤四 分摊不到,则进入 第二次分摊</p><p><strong>基于以下逻辑去匹配 订单流水,用以分摊.  每条 <span style="color: rgb(204,153,255);">手续费流水订单明细 <span style="color: rgb(0,0,0);">去 笛卡尔积匹配 <span style="color: rgb(51,153,102);">被匹配的 订单流水池 , <span style="color: rgb(0,0,0);">并基于下面的匹配条件进行过滤出实际上匹配的到的</span></span></span></span></strong></p><p><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);">(0) </span></span></span><span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池</strong> </span><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,153,102);">的 <strong><span style="color: rgb(255,102,0);">hi卡支付金额-退款</span></strong> 必须&gt;0 </span></span></span></p><p>(1) <span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池</strong> <span style="color: rgb(0,0,0);">的 业务时间 必须在 当月</span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(2) <strong><span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong>必须是 海拍客自营订单(sale-dc_id = 0 或者 -1 ) </span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);">(3) <span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池 </strong></span>必须是 实货订单 (即 业务组 不等于 卡券票,其他)</span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);">(4)<strong> 手续费流水订单明细 </strong><span style="color: rgb(0,0,0);">的门店的 省份id,城市id</span> <strong>= <span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong><span style="color: rgb(0,0,0);">的门店的 省份id,城市id  ## 步骤四里和步骤三 就差在一个 步骤4和步骤5</span></span></span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">(6) <span style="color: rgb(204,153,255);"><strong>手续费流水订单明细 </strong></span>的AB类型<strong> = <span style="color: rgb(51,153,102);">被匹配的 订单流水池</span> </strong>的AB类型</span></span></span></span></p><p><br/></p><h3 id="id-3.hi卡分摊收款手续费-步骤五、基于每一条手续费流水订单明细对应的被匹配的订单流水池的明细,分别计算其占比,分摊">步骤五、基于每一条 <strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong>对应的 <span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(51,153,102);"><strong>被匹配的 订单流水池 </strong></span><span style="color: rgb(0,0,0);">的明细,分别计算其占比,分摊</span></span></span></span></h3><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(23,43,77);">分别计算出每一条费用流水的 <span style="color: rgb(255,0,0);"><strong>hi卡支付金额-退款</strong></span>  占比, 并计算理论的每一条订单被分摊到的 <span style="color: rgb(255,0,0);">【收款手续费】 <span style="color: rgb(0,0,0);">,一条 订单 可能被多条 手续费流水 分摊到.  </span></span></span></span></span></span></span></p><p><span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(23,43,77);">另外,因为是按月截止分摊. 因此退款也是截止到当月最后一天即可.</span></span></span></span></span></p><p><br/></p><h3 id="id-3.hi卡分摊收款手续费-步骤六、产出每一条费用对应的订单流水明细表">步骤六、产出每一条费用对应的订单流水明细表</h3><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left;" class="confluenceTh"><p>字段</p></th><th style="text-align: left;" class="confluenceTh"><p>备注</p></th></tr></thead><tbody><tr><td style="text-align: left;" class="confluenceTd">主键id</td><td style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p><strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong>对应着原有的订单的 trade_no,order_id</p></td><td style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong>对应着原有的订单的 original_type</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong>对应着原有的订单的 <span style="color: rgb(255,0,0);">【收款手续费】 </span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">商品 品牌名称</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td style="text-align: left;" class="confluenceTd">---------------------------以下为明细维度</td><td style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 trade_no,order_id</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 original_type</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 业务组,一级类目,品牌名</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 <span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(204,153,255);"><span style="color: rgb(23,43,77);"><span style="color: rgb(255,0,0);"><strong>hi卡支付金额-退款</strong></span></span></span></span></span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">被分摊到的订单流水明细的</span><span> <span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(23,43,77);"><span style="color: rgb(255,0,0);">【收款手续费】</span></span></span></span></span></span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr></tbody></table></div><p><br/></p><h3 id="id-3.hi卡分摊收款手续费-步骤七、聚合汇总,并合并回主表">步骤七、聚合汇总,并合并回主表</h3><p>按 <strong><span style="color: rgb(204,153,255);">手续费流水订单明细 </span></strong>对应着原有的订单的 trade_no,order_id 进行求和 &quot;<span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">被分摊到的订单流水明细的</span><span> <span style="color: rgb(51,153,102);"><span style="color: rgb(0,0,0);"><span style="color: rgb(23,43,77);"><span style="color: rgb(255,0,0);">【收款手续费】</span></span></span></span></span></span>&quot;, 即为 <span style="color: rgb(51,102,255);">【hi卡分摊收款手续费】</span></p><p><br/></p><p>合并回去,究竟是起个新的 original_type,还是直接 left join 回老的 orignal_type 0 或 1 . 开发同学自己判定即可.  </p><p><br/></p><h1 id="id-3.hi卡分摊收款手续费-监控预警">监控预警</h1><p><span style="color: rgb(255,0,0);">保证以下预警规则T+1运行,且预警推送到 渠道毛利报表需求群中.</span></p><p><span style="color: rgb(255,0,0);">且保留SQL,保证告警了可以快速定位到. 可参见 <a class="external-link" href="https://meta.yangtuojia.com/front-static/dqc/monitordetail?id=294" rel="nofollow" style="text-decoration: none;">DQC配置</a></span></p><p><span style="color: rgb(255,0,0);">请直接详见  <a href="http://k.yangtuojia.com/pages/viewpage.action?pageId=57077933" rel="nofollow" style="text-decoration: none;">http://k.yangtuojia.com/pages/viewpage.action?pageId=57077933</a></span></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/98208314/98208493.png">image2022-6-22_10-32-29.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/98208314/98208494.png">image2022-6-22_10-35-18.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/98208314/98208498.png">image2022-6-22_10-38-38.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on 2023-12-19 10:51</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
