<!DOCTYPE html>
<html>
    <head>
        <title>产品组 : V3版本</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">产品组</a></span>
                            </li>
                                                    <li>
                                <span><a href="70335729.html">01_数据逻辑及模型设计思路</a></span>
                            </li>
                                                    <li>
                                <span><a href="59212886.html">三、费用</a></span>
                            </li>
                                                    <li>
                                <span><a href="61057821.html">营销费用之优惠券</a></span>
                            </li>
                                                    <li>
                                <span><a href="54522107.html">2. 优惠券之采购营销费用(原名:业务线营销费用)</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            产品组 : V3版本
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> 未知用户 (lei.xue)</span>, last modified on 2022-06-16
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 class="auto-cursor-target" id="V3版本-修订记录"><strong>修订记录</strong></h1><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/><col/></colgroup><thead><tr><th style="text-align: left;" class="confluenceTh"><p>版本号</p></th><th style="text-align: left;" class="confluenceTh"><p>内容</p></th><th style="text-align: left;" class="confluenceTh"><p>作者</p></th><th style="text-align: left;" class="confluenceTh"><p>时间</p></th><th colspan="1" style="text-align: left;" class="confluenceTh"><p>备注</p></th></tr></thead><tbody><tr><td colspan="1" style="text-align: left;" class="confluenceTd">V3</td><td colspan="1" style="text-align: left;" class="confluenceTd">采购和渠道营销费用同频. 全面更改 采购营销费用的计算规则</td><td colspan="1" style="text-align: left;" class="confluenceTd">阿雷</td><td colspan="1" style="text-align: left;" class="confluenceTd">2021/03/12</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">V3.1</td><td colspan="1" class="confluenceTd">新增 加价券和异常其他 排除分摊的场景</td><td colspan="1" class="confluenceTd">阿雷</td><td colspan="1" class="confluenceTd">2021/03/16</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">V3.2</td><td colspan="1" class="confluenceTd"><span style="color: rgb(23,43,77);">新增 找订单时不能找到指定直播店订单的逻辑</span></td><td colspan="1" class="confluenceTd">阿雷</td><td colspan="1" class="confluenceTd">2021/03/30</td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" class="confluenceTd">V3.3</td><td colspan="1" class="confluenceTd">修改 指定直播店的逻辑</td><td colspan="1" class="confluenceTd">阿雷</td><td colspan="1" class="confluenceTd">2021/06/23</td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><h1 id="V3版本-改动的业务背景"><strong>改动的业务背景</strong></h1><p><strong>在 <a href="61057750.html">V2版本-已废弃</a></strong>版本开发过程中, 临时接到小样确认. 目前 的采购和渠道的考核不同频. 出现了问题. 因此需要调整.</p><p>例如, 采购和渠道都考核 毛利.    毛利中的 仅有 营销费用中的 优惠券 的分摊规则 是不一致的.</p><p><br/></p><p>例如, 采购之前是 采购发的才承担.  渠道现在是 所有的都承担.</p><p>会导致,  某一个订单,可能是 渠道疯狂发券才拿下的.  导致在渠道视角,这个订单的毛利是负数的. </p><p>但是在采购视角,这个优惠券不算给采购.  采购还会觉得 这订单我赚钱了.  但公司实际上是亏钱了. 这就是不一致. </p><p><br/></p><p>因此本次改动的需求就是将 采购和渠道都拉进来, 承担同频. 保证 我亏你也亏, 我赚你也赚. 采购和渠道一起发力. </p><h1 id="V3版本-V3版本--最新版-21年1月至今"><strong>V3版本--最新版-21年1月至今</strong></h1><h2 id="V3版本-数据结果">数据结果</h2><p>每一个正向和逆向的order对应的 (分摊后的) 采购营销费用.   &gt;&gt;&gt;这里回头要专门拉个会,统一一个名词定义. </p><p>注意! 在所有上游的加工过程中, 必须要将该字段 称之为 优惠券金额. 而不是 采购营销费用.</p><p>只有最后一步(dw_gross_profit_all_d), 汇总回来的时候,才算是 营销费用! </p><h2 id="V3版本-名词字段">名词字段</h2><div class="table-wrap"><table class="relative-table wrapped confluenceTable" style="width: 86.3309%;"><colgroup><col style="width: 32.2288%;"/><col style="width: 54.0326%;"/><col style="width: 13.6035%;"/></colgroup><thead><tr><th style="text-align: left;" class="confluenceTh"><p>名词</p></th><th style="text-align: left;" class="confluenceTh"><p>逻辑</p></th><th colspan="1" class="confluenceTh">备注</th></tr></thead><tbody><tr><td style="text-align: left;" class="confluenceTd"><span style="color: rgb(0,0,255);">实际海拍客承担优惠券金额流水(金额1)</span></td><td style="text-align: left;" class="confluenceTd"><p>=<span style="color: rgb(255,102,0);">实际海拍客承担优惠券金额流水_需要均摊(金额2) </span></p><p><span style="color: rgb(255,102,0);">+ 实际海拍客承担优惠券金额流水_不要均摊(金额3)</span></p></td><td colspan="1" class="confluenceTd">V3改动. 这里去掉了三大业务线的规则</td></tr><tr><td style="text-align: left;" class="confluenceTd"><span style="color: rgb(255,102,0);">实际海拍客承担优惠券金额流水_不要均摊(金额2)</span></td><td style="text-align: left;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td style="text-align: left;" class="confluenceTd"><span style="color: rgb(255,102,0);">实际海拍客承担优惠券金额流水_需要均摊_均摊前(金额3)</span></td><td style="text-align: left;" class="confluenceTd"><br/></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><span style="color: rgb(204,153,255);">实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)</span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><p><span style="color: rgb(255,102,0);">实际海拍客承担优惠券金额流水_需要均摊_均摊前(金额3)</span></p><p><span style="color: rgb(255,102,0);">= <span style="color: rgb(204,153,255);">实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)</span></span></p></td><td colspan="1" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><span style="color: rgb(255,0,0);">采购营销费用</span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><span style="color: rgb(255,0,0);">采购营销费用 = <span style="color: rgb(204,153,255);">实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4) + <span style="color: rgb(255,102,0);">实际海拍客承担优惠券金额流水_不要均摊(金额2)</span></span></span></td><td colspan="1" class="confluenceTd"><br/></td></tr></tbody></table></div><h2 id="V3版本-计算步骤">计算步骤</h2><p>备注&gt; 严格来讲,下文所有计算逻辑都是按照 平台券 的视角来进行开展.  </p><h3 id="V3版本-一、产出实际海拍客承担优惠券金额流水(金额1)--同渠道视角保持一致">一、产出 <span style="color: rgb(0,0,255);">实际海拍客承担优惠券金额流水(金额1)--同渠道视角保持一致</span></h3><p>请参见 <a href="94764949.html">0. 实际海拍客承担优惠券金额流水(金额1)</a></p><p><br/></p><h3 id="V3版本-二、判断是否要进行分摊(V3版本重大变动)">二、判断是否要进行分摊(V3版本重大变动)</h3><h4 id="V3版本-1.获取费用流水对应的和平台券的费用归属一级类目和费用归属品牌."><strong>1.获取 费用流水对应的 <a href="61055722.html">1. 优惠券采购承担方</a> 和 平台券的 费用归属一级类目 和 费用归属品牌.</strong></h4><p>详见PRD.此前的需求中,单独对其进行定义. 就是为了在这里判断. </p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">字段名</th><th class="confluenceTh">规则</th></tr><tr><td class="confluenceTd">优惠券采购承担方</td><td class="confluenceTd"><p>必填. 一定有值</p><p>可能是数组. 存在一条记录有多个承担方.例如 ['奶粉组','尿不湿组']</p></td></tr><tr><td class="confluenceTd">费用归属一级类目</td><td class="confluenceTd"><p>当 海拍客费用归属一级部门为 B类及长尾,大贸,进口品牌时, 为必填. </p><p>其他则必定为空.</p><p>可能是数组. 存在一条记录有多个例如 ['奶粉','尿不湿']</p></td></tr><tr><td class="confluenceTd">费用归属品牌</td><td class="confluenceTd"><p>当 海拍客费用归属一级部门为 B类及长尾,大贸,进口品牌时才会有值,否则必定为空.</p><p>可能是数组. 存在一条记录有多个例如 ['奶粉','尿不湿']</p></td></tr></tbody></table></div><h4 id="V3版本-2.判断是否一致以及是否需要分摊"><strong>2.判断是否一致以及是否需要分摊</strong></h4><p><span style="color: rgb(255,0,0);">注意! 这里可能出现 一个定义,但是名词对不上的情况. 例如 BD,bd,BD部,bd部 这四个值,其实是一个定义. </span></p><p>判断的和核心是基于上面的三个字段进行判断. 如果 考核GMV和优惠券费用承担方 的维度一致,则不需要分摊. 否则,则需要分摊.   </p><p>考核GMV承担维度一定是单个值的. 优惠券费用是多个值. <span style="color: rgb(255,0,0);">因此是 前者包含在后者,即视为 不需要分摊. </span></p><p><span style="color: rgb(0,0,0);">如果 优惠券上不存在对应的字段, 则不需要判断订单上的考核GMV承担维度是否需要包含</span></p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><th class="confluenceTh">优惠券费用字段(多个值)</th><th class="confluenceTh">考核GMV承担维度(唯一值)</th></tr><tr><td class="confluenceTd">优惠券采购承担方</td><td class="confluenceTd"><p>业绩业务组</p></td></tr><tr><td class="confluenceTd">费用归属一级类目(可能为空)</td><td class="confluenceTd"><p>一级类目</p></td></tr><tr><td class="confluenceTd">费用归属品牌(可能为空)</td><td class="confluenceTd"><p>品牌</p></td></tr></tbody></table></div><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/61057752/61063027.png" data-image-src="attachments/61057752/61063027.png" data-unresolved-comment-count="0" data-linked-resource-id="61063027" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2021-3-16_10-56-25.png" data-base-url="http://k.yangtuojia.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="61057752" data-linked-resource-container-version="15"></span></p><h3 id="V3版本-三、对待分摊的费用流水进行分摊,并聚合汇总,合并,产出[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)]">三、对待分摊的费用流水进行分摊,并聚合汇总,合并,产出 <span style="color: rgb(204,153,255);">[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)]</span></h3><h4 id="V3版本-1.获取需要分摊的费用流水及其[实际海拍客承担优惠券金额流水(金额1)].该金额命名为实际海拍客承担优惠券金额流水_需要均摊_均摊前(金额3)(上图的红色部分)"><strong>1.获取 需要分摊的费用流水及其<span> </span></strong><span style="color: rgb(0,0,255);">[实际海拍客承担优惠券金额流水(金额1)]. <span style="color: rgb(0,0,0);">该金额命名为   <span style="color: rgb(255,102,0);">实际海拍客承担优惠券金额流水_需要均摊_均摊前(金额3)  <span style="color: rgb(0,0,0);">(上图的红色部分)</span></span></span></span></h4><p>当判断该费用流水按照上面的流程为 需要分摊时,则进行下面的流程. </p><h4 id="V3版本-2.按照每一条优惠券费用流水的相关字段,定位关联的待分摊订单流水">2. 按照每一条优惠券费用流水的相关字段,定位关联的待分摊订单流水</h4><p><span style="color: rgb(255,0,0);">请注意! 这里是涉及到两波订单. 一波是本身的毛利报表数据,即对应的 优惠券费用流水.   一波是额外的订单池. 是当需要分摊时,是为了定位需要参与分摊的订单. </span></p><p><br/></p><p><span style="color: rgb(23,43,77);">需要符合以下条件来判断是否符合要求</span></p><p><span style="color: rgb(0,0,0);">1) 常规分摊规则</span></p><p>    (1) 被定位的订单流水<span style="color: rgb(0,51,102);">上的 业务组 包含在  优惠券费用流水上的优惠券采购承担方(<span style="color: rgb(255,0,0);">跟渠道最大的区别</span>)</span></p><p><span style="color: rgb(0,51,102);">    (2) 订单流水时间 = 当月</span></p><p><span style="color: rgb(0,51,102);">    (3) 如果平台优惠券有类目集合, <span style="color: rgb(23,43,77);">订单上的 一级类目名称 包含在 平台优惠券上的 一级类目集合. <span style="color: rgb(255,0,0);">否则,则不需要判断该条件</span></span></span></p><p><span style="color: rgb(0,51,102);">    (4) 如果平台优惠券有品牌,则 <span style="color: rgb(23,43,77);">订单上的 品牌 包含在 平台优惠券上的 品牌集合. <span style="color: rgb(255,0,0);">否则,则不需要判断该条件</span></span></span></p><p><span style="color: rgb(0,51,102);"><span style="color: rgb(23,43,77);">    (5) 被定位的订单流水上的 门店省份,城市 = 优惠券费用流水上的订单的 门店省份,城市  </span></span></p><p><span style="color: rgb(0,51,102);"><span style="color: rgb(23,43,77);">    (6) 被定位的订单流水上的 必须为 海拍客自营订单( sale_dc_id = 0 或者 -1 )</span></span></p><p><span style="color: rgb(0,51,102);"><span style="color: rgb(23,43,77);">    (7) 被定位的订单流水上的 本身的 优惠券采购承担方  不能为  加价券 和 异常其他 <span style="color: rgb(255,0,0);">(V3.1新增)</span></span></span></p><p><span style="color: rgb(0,51,102);"><span style="color: rgb(23,43,77);"><span style="color: rgb(255,0,0);"><span style="color: rgb(0,0,0);"><span> </span>   (8) shop_id != 'bcfb591b919e48e1804fcdce670c6b55'      </span>V3.2新增<span style="color: rgb(0,0,0);"><span> </span>(源于<span> </span></span><a href="http://k.yangtuojia.com/pages/viewpage.action?pageId=62687112" rel="nofollow" style="text-decoration: none;">202103_日常_抖音直播订单隔离方案</a><span style="color: rgb(0,0,0);">)</span></span></span></span></p><p><br/></p><p><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">2) <strong>降低兜底分摊逻辑--<span style="color: rgb(255,0,0);"><span> </span>极度重要! </span></strong></span></span></p><p><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);"><span style="color: rgb(23,43,77);">当执行了 1) , 定位有部分 费用还是分摊不到,则 进行降级判断.</span></span></span></p><p>    (1) 被定位的订单流水<span style="color: rgb(0,51,102);">上的 业务组 包含在 优惠券费用流水上的优惠券采购承担方(<span style="color: rgb(255,0,0);">跟渠道最大的区别</span>)</span></p><p><span style="color: rgb(0,51,102);">    (2) 订单流水时间 = 当月</span></p><p>   <span style="color: rgb(0,51,102);"><span style="color: rgb(23,43,77);"> (3) 被定位的订单流水上的 必须为 海拍客自营订单( sale_dc_id = 0 或者 -1 )</span></span></p><p><span style="color: rgb(0,51,102);"><span style="color: rgb(23,43,77);">    (4) 被定位的订单流水上的 本身的 优惠券采购承担方  不能为  加价券 和 异常其他  <span style="color: rgb(255,0,0);">(V3.1新增)</span></span></span></p><p><span style="color: rgb(0,0,0);"><span> </span>   (5)   <span style="color: rgb(255,0,0);">V3.2新增 V3.3修改 <span style="color: rgb(23,43,77);"><s>shop_id != 'bcfb591b919e48e1804fcdce670c6b55' </s>   <span style="color: rgb(0,51,102);">门店不属于 门店分组(ID:1750) </span></span><span style="color: rgb(23,43,77);"> 详见  <a class="external-link" href="https://onequery.yangtuojia.com/?id=12052" rel="nofollow" style="text-decoration: none;">SQL示例</a>    </span><span style="color: rgb(23,43,77);">(需求源于<span> </span><a href="http://k.yangtuojia.com/pages/viewpage.action?pageId=62687112" rel="nofollow" style="text-decoration: none;">202103_日常_抖音直播订单隔离方案</a>)</span></span></span></p><p><br/></p><p><span style="color: rgb(0,51,102);">PS: 这里在业务验证的过程中,可能需要二次调整. 不排除为了精度问题,加上第二次兜底判断逻辑</span></p><p><br/></p><p><span style="color: rgb(0,51,102);">注意事项</span></p><p><span style="color: rgb(0,51,102);">优惠券采购承担方为 &quot;异常其他&quot; 和 &quot;加价券&quot; 的,是必然分摊不到的. 这是业务允许的规则. </span></p><p><br/></p><h4 id="V3版本-3.按照每一条费用对应的订单流水,分别计算其占比">3.按照每一条费用对应的订单流水,分别计算其占比</h4><p>分别计算出每一条费用流水的 实货GMV-退款占比, 并计算理论的每一条订单的 <span style="color: rgb(204,153,255);">实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)  </span></p><p><span style="color: rgb(0,0,0);">实货GMV-退款 的逻辑,可参见 <strong><a href="http://k.yangtuojia.com/pages/viewpage.action?pageId=54522053" rel="nofollow" style="text-decoration: none;">99. 计算分摊占比的指标</a> </strong>.  另外,因为是按月截止分摊. 因此退款也是截止到当月最后一天即可.</span></p><p><br/></p><p>单条费用的单条订单的 <span style="color: rgb(204,153,255);">实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4) </span><span style="color: rgb(255,102,0);"><span style="color: rgb(0,51,102);">=    单条订单的实货GMV-退款 / 该费用对应的所有订单的GMV-退款的总额 *  实际海拍客承担优惠券金额流水_需要均摊_均摊前(金额3)</span></span></p><p><span style="color: rgb(204,153,255);"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/61057752/61058085.png" data-image-src="attachments/61057752/61058085.png" data-unresolved-comment-count="0" data-linked-resource-id="61058085" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2021-3-12_14-19-6.png" data-base-url="http://k.yangtuojia.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="61057752" data-linked-resource-container-version="15"></span></span></p><h4 id="V3版本-4.产出每一条费用对应的订单流水明细表">4.产出每一条费用对应的订单流水明细表</h4><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left;" class="confluenceTh"><p>字段</p></th><th style="text-align: left;" class="confluenceTh"><p>备注</p></th></tr></thead><tbody><tr><td style="text-align: left;" class="confluenceTd">主键id</td><td style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td style="text-align: left;" class="confluenceTd">优惠券费用流水对应着原有的订单的 trade_no,order_id</td><td style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">优惠券费用流水对应着原有的订单的 original_type</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">优惠券费用流水对应着原有的订单的 <span style="color: rgb(255,102,0);">[实际海拍客承担优惠券金额流水_需要均摊_均摊前(金额3)]</span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">优惠券采购承担方</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">费用归属的一级类目集合(中文名)</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">费用归属的品牌名集合(中文名)</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td style="text-align: left;" class="confluenceTd">---------------------------以下为明细维度</td><td style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 trade_no,order_id</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 original_type</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 业务组,一级类目,品牌名</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">被分摊到的订单流水明细的 实货GMV-退款</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd">该优惠券对应的订单的 实货GMV-退款 之和</td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">被分摊到的订单流水明细的</span><span> </span>实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)</span></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr><tr><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td><td colspan="1" style="text-align: left;" class="confluenceTd"><br/></td></tr></tbody></table></div><p><br/></p><h4 id="V3版本-5.聚合汇总被分摊到的订单流水明细的[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)]即1个订单可能会被大量的优惠券进行分摊.导致明细过多.">5.聚合汇总 被分摊到的订单流水明细 的 <span style="color: rgb(204,153,255);">[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)] </span>即1个订单可能会被大量的优惠券进行分摊. 导致明细过多. </h4><p>在这一层进行聚合.  聚合到单个订单在单个流水日期单个类型下一行</p><h4 id="V3版本-6.将被分摊到的订单流水明细的[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)]合并回主表">6. 将 被分摊到的订单流水明细的 <span style="color: rgb(204,153,255);">[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)] </span><span style="color: rgb(204,153,255);"><span style="color: rgb(0,0,0);">合并回主表</span></span></h4><p>这里依赖我们数据模型的设计. 到底是先在现有的基础上改,还有彻底改成 数据类型和业务类型做拆分的流水表.(因为业务要考虑到本地的数据量的问题. 我们可先做流水表,再按业务需求打成现有的模式)</p><p>以下先用前者解释</p><p><br/></p><h3 id="V3版本-四、汇总[采购营销费用]">四、汇总<span> </span><span style="color: rgb(255,0,0);">[采购营销费用]</span></h3><h4 id="V3版本-[采购营销费用]=[实际海拍客承担优惠券金额流水_不要均摊(金额2)]+[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)]"><span style="color: rgb(255,0,0);">[采购营销费用] = <span> </span><span style="color: rgb(255,102,0);">[实际海拍客承担优惠券金额流水_不要均摊(金额2)] </span>+ </span><span style="color: rgb(204,153,255);">[实际海拍客承担优惠券金额流水_需要均摊_均摊后(金额4)]</span></h4><p><span style="color: rgb(0,0,0);">注意! 这里的两个指标,前者本来就已经在现有的 订单流水上, 后者是通过在 三、6  ,合并回来的. </span></p><p><br/></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/61057752/61057901.png">image2021-1-12_21-33-3.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/61057752/61058036.png">image2021-3-12_14-1-21.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/61057752/61058038.png">image2021-3-12_14-2-44.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/61057752/61058085.png">image2021-3-12_14-19-6.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/61057752/61063027.png">image2021-3-16_10-56-25.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on 2023-12-19 10:52</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
