with subject as (
    SELECT *,
           case when feature_type = 1 then '新签'
                when feature_type = 2 then '复购'
                else null end as a2_subject_type
    FROM ytdw.dwd_p0_subject_d
    WHERE dayid = DATE_FORMAT(DATE_SUB(CURRENT_DATE, 1), 'yyyyMMdd')  --这里永远取最新的分区数据
    AND id IN (11290, 11291, 11287, 11288, 11295, 11296, 11292, 11293, 11297, 11298, 11299, 11300, 11301, 11302, 11303, 11304, 11305, 11306, 11307, 11308, 11309, 11310, 11311, 11312, 11313, 11314, 11315, 11316, 11317, 11318, 11319, 11320, 11321, 11322, 11323, 11324, 11325, 11326, 11327, 11328, 11329, 11330, 11331, 11332, 11333, 11334, 11335, 11336, 11337, 11338, 11339, 11340, 11341, 11342, 11343, 11344, 11345, 11346, 11347, 11348, 11349, 11350, 11351, 11352, 11353, 11354, 11355, 11356, 11357, 11358, 11359, 11360, 11361, 11362, 11363, 11364, 11365, 11366, 11367, 11368, 11369, 11370, 11371, 11372, 11373, 11374, 11375, 11376, 11377, 11378, 11379, 11380, 11381, 11382, 11383, 11384, 11385, 11386, 11387, 11388, 11389, 11390, 11391, 11392, 11393, 11394, 11395, 11396, 11397, 11398, 11399, 11400, 11401, 11402, 11403, 11404, 11405, 11406, 11407, 11408)
    AND dmp_id is not null
)

INSERT OVERWRITE TABLE ads_crm_a2_subject_base_d PARTITION(dayid = '${v_date}')
SELECT id,
       subject_name,
       memo,
       status,
       a2_subject_type,
       subject_month,
       do_start,
       do_end,
       shop_cluster_id,
       case when id IN (11295, 11296, 11292, 11293, 11299, 11300, 11303, 11304, 11307, 11308, 11311, 11312, 11315, 11316, 11319, 11320, 11323, 11324, 11327, 11328, 11331, 11332, 11335, 11336, 11339, 11340, 11343, 11344, 11347, 11348, 11351, 11352, 11355, 11356, 11359, 11360, 11363, 11364, 11367, 11368, 11371, 11372, 11375, 11376, 11379, 11380, 11383, 11384, 11387, 11388, 11391, 11392, 11395, 11396, 11399, 11400, 11403, 11404, 11407, 11408)
            then 1 else 0 end as need_stats --1表示需要统计的，目前是3省的需要统计
FROM subject
WHERE subject_month = substr('${v_date}', 1, 6)